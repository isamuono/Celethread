$('#tcomment-Modal<%= @gthread.id %>').html("<%= escape_javascript(render partial: 'comments/comment_index_modal', locals: { gthread: @gthread, comments: @comments }) %>");

$('#tcomment-Modal<%= @gthread.id %>').modal('show');

$('#tcomment-Modal<%= @gthread.id %>').on('hidden.bs.modal', function() {
  $('#tcomment-Modal<%= @gthread.id %>').modal('hide');
  
  $.ajax({
    'url': '/channels/<%= @gthread.channel.id %>/gthreads/<%= @gthread.g_uid %>',
    'dataType': 'html',
    'cache': false
  })
  .then(function(data) {
    window.history.pushState(null, null, '/channels/<%= @channel.id %>/gthreads');
  })
  
  // モーダルを開いた回数分、コメントがブロードキャストされるのを防ぐため、モーダルを閉じる度に購読を解除する
  //var subscriptions = App.cable.subscriptions['subscriptions'];
  
  //subscriptions.forEach(function (subscription) {
    //App.cable.subscriptions.remove(subscription);
  //});
  App.comment.unsubscribe();
});

window.history.pushState(null, null, '/channels/<%= @channel.id %>/gthreads/<%= @gthread.g_uid %>');